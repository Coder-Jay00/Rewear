{% extends "base.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ReWear - Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- Navbar (same as dashboard, with admin badge) -->


<!-- Admin Dashboard -->
<div class="container py-5">
  <h3 class="mb-4">Admin Dashboard</h3>

  <!-- Section: Users -->
  <div class="mb-5">
    <h5>Manage Users</h5>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>User ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Registered On</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.id }}</td>
          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.registered_on.strftime('%Y-%m-%d') }}</td>
          <td>
            {% if not user.is_blocked %}
            <form method="post" action="{{ url_for('admin_block_user', user_id=user.id) }}" style="display:inline;">
              {{ csrf_token() if csrf_token is defined }}
              <button type="submit" class="btn btn-sm btn-danger">Block</button>
            </form>
            {% else %}
            <span class="badge bg-secondary">Blocked</span>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center text-muted">No users found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Section: Listings -->
  <div class="mb-5">
    <h5>Manage Listings</h5>
    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>Item ID</th>
          <th>Title</th>
          <th>Owner</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td>{{ item.id }}</td>
          <td>{{ item.title }}</td>
          <td>{{ item.uploader.name }}</td>
          <td>
            <span class="badge bg-{{ 'success' if item.status == 'active' else 'secondary' }}">{{ item.status.capitalize() }}</span>
          </td>
          <td>
            <form method="post" action="{{ url_for('admin_delete_item', item_id=item.id) }}" style="display:inline;">
              {{ csrf_token() if csrf_token is defined }}
              <button type="submit" class="btn btn-sm btn-outline-danger">Remove</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center text-muted">No items found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Section: Requests -->
  <div>
    <h5>Exchange Requests</h5>
    <table class="table table-sm table-striped">
      <thead>
        <tr>
          <th>Request ID</th>
          <th>Item</th>
          <th>From</th>
          <th>Status</th>
          <th>Approve</th>
        </tr>
      </thead>
      <tbody>
        {% for req in requests %}
        <tr>
          <td>{{ req.id }}</td>
          <td>{{ req.item_title }}</td>
          <td>{{ req.requester_email }}</td>
          <td>
            <span class="badge bg-{{ 'warning text-dark' if req.status == 'pending' else 'success' if req.status == 'approved' else 'secondary' }}">{{ req.status.capitalize() }}</span>
          </td>
          <td>
            {% if req.status == 'pending' %}
            <form method="post" action="{{ url_for('admin_approve_request', request_id=req.id) }}" style="display:inline;">
              {{ csrf_token() if csrf_token is defined }}
              <button type="submit" class="btn btn-sm btn-success">Approve</button>
            </form>
            {% else %}
            <span class="text-muted">-</span>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center text-muted">No requests found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Footer -->
<footer class="text-center p-4 bg-white shadow-sm mt-5">
  <small>&copy; 2025 ReWear</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
{% endblock %}